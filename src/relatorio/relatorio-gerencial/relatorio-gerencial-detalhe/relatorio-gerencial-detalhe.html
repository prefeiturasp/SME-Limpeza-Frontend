<div class="card" id="to-export">
  <div class="card-body">

    <h4 class="card-title">
      BOLETIM DE MEDIÇÃO
      <button type="button" class="btn btn-outline-info d-print-none" onclick="window.print();">
        <i class="icon-printer mr-1"></i>Imprimir
      </button>
    </h4>

    <hr>

    <div class="row">
      <div class="col-12">
        <div class="alert alert-info" ng-if="vm.dados.flagAprovadoFiscal">
          Relatório consolidado pelo fiscal {{vm.dados.nomeUsuarioAprovacaoFiscal}} em
          {{vm.dados.dataHoraAprovacaoFiscal | date:'dd/MM/yyyy - HH:mm:ss'}}.
        </div>

        <div class="alert alert-danger" ng-if="!vm.dados.flagAprovadoFiscal && !vm.dados.flagPodeFiscalizar">
          Este relatório ainda não foi consolidado.
        </div>

        <div class="alert alert-danger" ng-if="!vm.dados.flagAprovadoFiscal && vm.dados.flagPodeFiscalizar">
          Este relatório ainda não foi consolidado. Deseja consolidar?
          <a href="#" class="text-bold" ng-click="vm.consolidar()">
            Clique aqui!
          </a>
        </div>

      </div>
    </div>

    <div class="row" ng-if="vm.dados.flagAprovadoFiscal">
      <div class="col-12">

        <div class="alert alert-primary" ng-if="vm.dados.flagAprovadoDre && !vm.dados.flagPodeAprovar">
          Relatório aprovado pelo usuário {{vm.dados.nomeUsuarioAprovacaoDre}} em
          {{vm.dados.dataHoraAprovacaoDre | date:'dd/MM/yyyy - HH:mm:ss'}}.
        </div>

        <div class="alert alert-primary" ng-if="vm.dados.flagAprovadoDre && vm.dados.flagPodeAprovar">
          Relatório aprovado pelo usuário {{vm.dados.nomeUsuarioAprovacaoDre}} em
          {{vm.dados.dataHoraAprovacaoDre | date:'dd/MM/yyyy - HH:mm:ss'}}.
          Deseja reverter a aprovação? <a href="#" class="text-bold" ng-click="vm.reverterAprovacao()">Sim,
            reverter.</a>
        </div>

        <div class="alert alert-danger" ng-if="!vm.dados.flagAprovadoDre && !vm.dados.flagPodeAprovar">
          Este relatório ainda não foi aprovado.
        </div>

        <div class="alert alert-danger" ng-if="!vm.dados.flagAprovadoDre && vm.dados.flagPodeAprovar">
          Este relatório ainda não foi aprovado. O que você deseja fazer?
          <a href="#" class="text-bold" ng-click="vm.aprovar()">
            Aprovar</a> ou
          <a href="#" class="text-bold" ng-click="vm.desconsolidar()">
            Desconsolidar</a>.
        </div>

      </div>
    </div>

    <div class="row print-card-header">
      <div class="col mb-3 stretch-card">
        <div class="card">
          <div class="card-body d-flex flex-column justify-content-between">
            <div>
              <p class="mb-1">
                <span class="h4 mb-0 mr-2 font-weight-bold">
                  {{vm.dados.mes}}/{{vm.dados.ano}}
                </span>
              </p>
              <p class="mb-0 text-muted font-weight-light">Referência</p>
            </div>
            <div>
              <span class="badge badge-warning mt-3" ng-if="!vm.dados.flagAprovadoFiscal">
                Aguardando Fiscal
              </span>
              <span class="badge badge-info mt-3" ng-if="vm.dados.flagAprovadoFiscal && !vm.dados.flagAprovadoDre">
                Aguardando DRE
              </span>
              <span class="badge badge-success mt-3" ng-if="vm.dados.flagAprovadoDre">
                Aprovado
              </span>
            </div>
          </div>
        </div>
      </div>
      <div class="col mb-3 stretch-card">
        <div class="card">
          <div class="card-body d-flex flex-column justify-content-between">
            <div>
              <p class="mb-1">
                <span class="h4 mb-0 mr-2 font-weight-bold" ng-bind="vm.dados.unidadeEscolar.descricao"></span>
              </p>
              <p class="mb-0 text-muted font-weight-light">Unidade Escolar</p>
            </div>
            <div>
              <span class="badge badge-light text-black mt-3">
                Cód.: {{ vm.dados.unidadeEscolar.codigo }}
              </span>
              <span class="badge badge-light text-black mt-3">
                Tipo: {{ vm.dados.unidadeEscolar.tipo }}
              </span><br>
            </div>
          </div>
        </div>
      </div>

      <div class="col mb-3 stretch-card">
        <div class="card">
          <div class="card-body d-flex flex-column justify-content-between">
            <div>
              <p class="mb-1"><span class="h4 mb-0 mr-2 font-weight-bold"
                  ng-bind="vm.dados.prestadorServico.razaoSocial"></span></p>
              <p class="mb-0 text-muted font-weight-light">Prestador de Serviço</p>
            </div>
            <div class="d-inline-flex">
              <span class="badge badge-light text-black mt-3 mr-2">
                CNPJ: {{vm.dados.prestadorServico.cnpj | brCnpj}}
              </span><br>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row mt-1">
      <div class="col-12">
        <div class="card mb-3" ng-repeat="tipo in vm.dados.detalhe">
          <div class="card-body d-flex flex-column justify-content-between p-0">
            <p class="p-4 m-0 h4 uppercase text-bold text-white bg-primary" ng-bind="tipo.descricao"></p>
            <!-- <div class="tb-responsive"> -->
            <table class="table">
              <thead>
                <tr class="bg-light text-right">
                  <th class="text-left" style="width: 40%">Item da avaliação</th>
                  <th class="text-left" ng-if="vm.dados.contratoModelo === 1">Situação</th>
                  <th ng-style="{ 'width': vm.dados.flagAprovadoFiscal ? '15%' : '10%' }">Ocorrências
                  </th>
                  <th ng-if="vm.dados.contratoModelo === 1"
                    ng-style="{ 'width': vm.dados.flagAprovadoFiscal ? '15%' : '10%' }">Nota</th>
                  <th ng-style="{ 'width': vm.dados.flagAprovadoFiscal ? '15%' : '10%' }">Pontuação
                  </th>
                  <th
                    ng-if="vm.dados.contratoModelo === 1 && ((!vm.dados.flagAprovadoFiscal && vm.dados.flagPodeFiscalizar) || usuario.usuarioOrigem.codigo === 'sme')">
                    Ação</th>
                </tr>
              </thead>
              <tbody>
                <tr class="text-right" ng-repeat="variavel in tipo.variaveis">
                  <td class="text-left" ng-bind="variavel.descricao"></td>
                  <td class="text-left" ng-if="vm.dados.contratoModelo === 1">
                    <span ng-if="variavel.situacao"
                      class="badge badge-{{variavel.situacao.classe}}">{{variavel.situacao.descricao}}</span>
                    <span ng-if="!variavel.situacao" class="badge badge-info">Não avaliado</span>
                  </td>
                  <td>
                    <div class="badge badge-pill badge-primary" ng-bind="variavel.ocorrencias.length"
                      ng-class="{'pointer': variavel.ocorrencias.length > 0}"
                      ng-click="vm.abrirModalOcorrencias(variavel.ocorrencias)"></div>
                  </td>
                  <td ng-if="vm.dados.contratoModelo === 1" ng-bind="variavel.nota === null ? ' - ' : variavel.nota">
                  </td>
                  <td ng-bind="vm.formatarDecimal(variavel.pontuacao)"></td>
                  <td
                    ng-if="vm.dados.contratoModelo === 1 && ((!vm.dados.flagAprovadoFiscal && vm.dados.flagPodeFiscalizar) || usuario.usuarioOrigem.codigo === 'sme')">
                    <button type="button" class="btn btn-outline-primary btn-sm"
                      ng-click="vm.abrirModalAvaliacao(tipo, variavel)">
                      <i class="icon-star mr-1"></i>Avaliar
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
            <!-- </div> -->
            <table class="table" ng-if="vm.dados.contratoModelo === 1">
              <thead>
                <tr class="bg-light">
                  <th class="text-center">Pontuação Parcial</th>
                  <th class="text-center">Peso Global</th>
                  <th class="text-center">Pontuação Final</th>
                </tr>
              </thead>
              <tbody>
                <tr class="text-right">
                  <td class="text-center" ng-bind="vm.formatarDecimal(tipo.pontuacaoParcial)"></td>
                  <td class="text-center" ng-bind="vm.formatarPercentual(tipo.peso)"></td>
                  <td class="text-center" ng-bind="vm.formatarDecimal(tipo.pontuacaoFinal)"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="row break-before">
      <div class="col-12">
        <div class="card mb-3">
          <div class="card-body d-flex flex-column justify-content-between p-0">
            <p class="p-4 m-0 h4 uppercase text-bold text-white bg-dark">RESUMO IMR</p>
            <div class="tb-responsive">
              <table class="table">
                <thead>
                  <tr class="bg-light text-center">
                    <th class="text-left" style="width: 45%">Variável Gerencial</th>
                    <th class="border-right">Pontuação</th>
                    <th class="border-right">Pontuação Final</th>
                    <th>Fator de Desconto</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="text-center" ng-repeat="tipo in vm.dados.detalhe">
                    <td class="text-left" ng-bind="tipo.descricao"></td>
                    <td class="border-right" ng-bind="vm.formatarDecimal(tipo.pontuacaoFinal)"></td>
                    <td class="border-right" ng-if="$index == 0" rowspan="{{vm.dados.detalhe.length}}"
                      ng-bind="vm.formatarDecimal(vm.dados.pontuacaoFinal)"></td>
                    <td ng-if="$index == 0" rowspan="{{vm.dados.detalhe.length}}"
                      ng-bind="vm.formatarPercentual(vm.dados.fatorDesconto)"></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row" ng-if="vm.dados.contratoModelo === 2">
      <div class="col-12">
        <div class="card">
          <div class="card-body d-flex flex-column justify-content-between p-0">
            <p class="p-4 m-0 h4 uppercase text-bold text-white bg-dark">GLOSA RH</p>
            <div class="tb-responsive">
              <table class="table">
                <thead>
                  <tr class="bg-light text-center">
                    <th class="text-left border-right">Cargo</th>
                    <th class="border-right" style="width: 15%">Valor Mensal</th>
                    <th class="border-right" style="width: 15%">Quantidade Ausente</th>
                    <th style="width: 15%">Valor Desconto</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="text-center" ng-repeat="c in vm.dados.equipeAlocada">
                    <td class="text-left border-right" ng-bind="c.descricao"></td>
                    <td class="border-right" ng-bind="c.valorMensal | finance:true:2"></td>
                    <td class="border-right" ng-bind="c.quantidadeAusente"></td>
                    <td class="border-right" ng-bind="c.valorDesconto | finance:true:2"></td>
                  </tr>
                  <tr class="text-center bg-light" ng-if="vm.dados.equipeAlocada && vm.dados.equipeAlocada.length > 0">
                    <td colspan="3"></td>
                    <td class="font-weight-bold" ng-bind="vm.dados.descontoGlosaRh | finance:true:2">
                    </td>
                  </tr>
                  <tr class="text-center" ng-if="!vm.dados.equipeAlocada || vm.dados.equipeAlocada.length === 0">
                    <td class="text-left border-right"> - </td>
                    <td class="border-right"> - </td>
                    <td class="border-right"> - </td>
                    <td class="border-right"> - </td>
                    <td class="border-right"> - </td>
                  </tr>
                </tbody>
              </table>

            </div>
          </div>
        </div>
        <small><strong>Desconto = </strong> Qtd. Ausente * (Valor Mensal / 21.74)</small>
      </div>
    </div>

    <div class="mt-5 w-100">
      <h4 class="text-right mb-4">
        Valor do Contrato: {{ vm.dados.valorBruto | finance:true:2 }}
      </h4>
      <h4 class="text-right mb-4">
        Glosa IMR: {{ vm.dados.valorDesconto | finance:true:2 }}
        <small>({{vm.formatarPercentual(vm.dados.fatorDesconto) }})</small>
      </h4>
      <h4 class="text-right mb-4" ng-if="vm.dados.contratoModelo === 2">
        Glosa RH: {{ vm.dados.descontoGlosaRh | finance:true:2 }}
      </h4>
      <h3 class="text-right text-bold mb-4">
        Total: {{ vm.dados.valorLiquido | finance:true:2 }}
      </h3>
    </div>

  </div>

</div>