<form novalidate name="formulario" ng-submit="vm.salvar(formulario)" autocomplete="off" autocorrect="off"
  autocapitalize="off" spellcheck="false">

  <div class="modal-header">
    <h5 class="modal-title" ng-if="vm.modal.isEditar">EDITAR USUÁRIO</h5>
    <h5 class="modal-title" ng-if="!vm.modal.isEditar">CADASTRAR USUÁRIO</h5>
    <button type="button" class="close" ng-click="vm.fecharModal()">
      <span aria-hidden="true">×</span>
    </button>
  </div>

  <div class="modal-body">

    <div class="row">
      <div class="col-lg-6 mb-0 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Dados gerais</h4>
            <p class="text-muted font-weight-light">Informações de identificação e acesso do usuário.
            <div class="row mt-4">
              <div class="col-12">
                <div class="form-group">
                  <label for="nome" class="obrigatorio">Nome</label>
                  <input type="text" id="nome" name="nome" class="form-control" ng-model="vm.modal.model.nome"
                    ng-class="{'is-invalid': (formulario.nome.$dirty && formulario.nome.$invalid)}" required>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <div class="form-group">
                  <label for="email" class="obrigatorio">E-mail</label>
                  <input type="email" id="email" name="email" class="form-control" ng-model="vm.modal.model.email"
                    ng-class="{'is-invalid': (formulario.email.$dirty && formulario.email.$invalid)}" required>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <div class="form-group">
                  <label for="senha" class="obrigatorio">Senha</label>
                  <input type="password" id="senha" name="senha" class="form-control" ng-model="vm.modal.model.senha"
                    ng-class="{'is-invalid': (formulario.senha.$dirty && formulario.senha.$invalid)}" required>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-5">
                <div class="form-group">
                  <label for="status" class="obrigatorio">Situação</label>
                  <select class="form-control" id="status" name="status" ng-model="vm.modal.model.idUsuarioStatus"
                    ng-options="status.id as status.descricao for status in vm.usuarioStatusList"
                    ng-class="{'is-invalid': (formulario.status.$dirty && formulario.status.$invalid)}" required>
                    <option value="" disabled>Selecione</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-6 mb-0 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Permissões</h4>
            <p class="text-muted font-weight-light">Informações do perfil de acesso e origem do usuário.

            <div class="row mt-4">
              <div class="col-12">
                <div class="form-group">
                  <label for="origem" class="obrigatorio">Origem</label>
                  <select class="form-control" id="origem" name="origem" ng-model="vm.modal.model.idUsuarioOrigem"
                    ng-change="vm.evtChangeUsuarioOrigem()"
                    ng-options="origem.id as origem.descricao for origem in vm.usuarioOrigemList"
                    ng-class="{'is-invalid': (formulario.origem.$dirty && formulario.origem.$invalid)}" required>
                    <option value="" disabled>Selecione</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="row"
              ng-if="vm.modal.model.idUsuarioOrigem && ['ue', 'ps'].includes(vm.origemSelecionada.codigo)">
              <div class="col-12">
                <div class="form-group">
                  <label for="cargo" class="obrigatorio">Perfil de Acesso</label>
                  <select class="form-control" id="cargo" name="cargo" ng-model="vm.modal.model.idUsuarioCargo"
                    ng-disabled="!vm.modal.model.idUsuarioOrigem"
                    ng-options="cargo.id as cargo.descricao for cargo in vm.usuarioCargoList"
                    ng-class="{'is-invalid': (formulario.cargo.$dirty && formulario.cargo.$invalid)}" required>
                    <option value="" disabled>Selecione</option>
                  </select>
                </div>
              </div>
              <div class="col-12" ng-if="vm.modal.model.idUsuarioCargo == 3 || vm.modal.model.idUsuarioCargo == 7">
                <div class="form-group">
                  <label for="urlNomeacao" class="obrigatorio">Link de Nomeação</label>
                  <input type="url" id="urlNomeacao" name="urlNomeacao" class="form-control"
                    ng-model="vm.modal.model.urlNomeacao"
                    ng-class="{'is-invalid': (formulario.urlNomeacao.$dirty && formulario.urlNomeacao.$invalid)}"
                    required>
                </div>
              </div>
            </div>

            <div class="row" ng-if="vm.modal.model.idUsuarioOrigem && vm.origemSelecionada.codigo != 'sme'">
              <div class="col-12">
                <div class="form-group">
                  <label for="origemDetalhe" class="obrigatorio" ng-bind="vm.origemSelecionada.descricao"></label>
                  <ui-select id="origemDetalhe" ng-model="vm.modal.model.idOrigemDetalhe">
                    <ui-select-match allow-clear="true" placeholder="Todos">
                      {{vm.origemSelecionada.codigo == 'ue' ? ($select.selected.codigo + ' - ') :
                      ''}}{{$select.selected.descricao}}</ui-select-match>
                    <ui-select-choices repeat="origemDetalhe in vm.origemDetalheList | filter: $select.search">
                      <span class="mb-0 d-block"
                        ng-bind-html="origemDetalhe.descricao | highlight: $select.search"></span>
                      <small class="my-2" ng-if="vm.origemSelecionada.codigo != 'dre'">{{vm.origemSelecionada.codigo
                        == 'ps' ? 'CNPJ:' : ''}}</small>
                      <small class="my-2" ng-if="vm.origemSelecionada.codigo != 'dre'"
                        ng-bind-html="(vm.origemSelecionada.codigo == 'ps' ? (origemDetalhe.cnpj | brCnpj) : (origemDetalhe.codigo + ' - ' + origemDetalhe.tipo)) | highlight: $select.search"></small>
                    </ui-select-choices>
                  </ui-select>
                </div>
              </div>
            </div>

            <div class="row"
              ng-if="usuario.usuarioOrigem.codigo === 'ps' && vm.modal.model.idUsuarioOrigem && vm.origemSelecionada.codigo === 'ps' && vm.modal.model.idUsuarioCargo === 8">
              <div class="col-12">
                <div class="form-group">
                  <label for="unidadeEscolarList" class="obrigatorio">Unidades Escolares</label>
                  <ui-select name="unidadeEscolarList" ng-model="vm.modal.model.unidadeEscolarList" class="form-control"
                    close-on-select="false" multiple required>
                    <ui-select-match>
                      {{$item.codigo}} - {{$item.descricao}}
                    </ui-select-match>
                    <ui-select-choices repeat="unidade in vm.unidadeEscolarLista | filter: $select.search">
                      <span class="mb-0 d-block" ng-bind-html="unidade.descricao | highlight: $select.search"></span>
                      <small class="my-2" ng-bind-html="unidade.codigo | highlight: $select.search"></small>
                      <small class="my-2"> - </small>
                      <small class="my-2" ng-bind-html="unidade.tipo | highlight: $select.search"></small>
                    </ui-select-choices>
                  </ui-select>
                </div>
              </div>
            </div>

            <div class="row"
              ng-if="usuario.usuarioOrigem.codigo === 'sme' && vm.modal.model.idUsuarioOrigem && vm.origemSelecionada.codigo === 'sme'">
              <div class="col-12">
                <div class="form-group">
                  <label for="contratoList" class="obrigatorio">Contratos</label>
                  <ui-select name="contratoList" ng-model="vm.modal.model.contratoList" class="form-control"
                    close-on-select="false" multiple required>
                    <ui-select-match>
                      {{$item.codigo}} - {{$item.descricao}}
                    </ui-select-match>
                    <ui-select-choices repeat="contrato in vm.contratoLista | filter: $select.search">
                      <span class="mb-0 d-block" ng-bind-html="contrato.descricao | highlight: $select.search"></span>
                      <small class="my-2">Código:</small>
                      <small class="my-2" ng-bind-html="contrato.codigo | highlight: $select.search"></small>
                    </ui-select-choices>
                  </ui-select>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-footer">
    <button type="submit" class="btn btn-success" ng-disabled="formulario.$invalid">Salvar</button>
  </div>

</form>